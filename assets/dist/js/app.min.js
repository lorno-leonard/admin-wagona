var app=angular.module("app-admin-wagona",["ui.router"]);app.config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/"),a.state("dashboard",{url:"/",templateUrl:"dashboard.html",controller:"dashboardCtrl"}).state("data-entry",{url:"/data-entry",templateUrl:"data-entry.html",controller:"dataEntryCtrl"}).state("data-entry-country",{url:"/data-entry-country",templateUrl:"data-entry.country.html",controller:"dataEntryCountryCtrl",data:{parentState:"data-entry",parentStateTitle:"Data Entry"}}).state("data-entry-syllabi",{url:"/data-entry-syllabi",templateUrl:"data-entry.syllabi.html",controller:"dataEntrySyllabiCtrl",data:{parentState:"data-entry",parentStateTitle:"Data Entry"}}).state("data-entry-subject",{url:"/data-entry-subject",templateUrl:"data-entry.subject.html",controller:"dataEntrySubjectCtrl",data:{parentState:"data-entry",parentStateTitle:"Data Entry"}}).state("data-entry-topic",{url:"/data-entry-topic",templateUrl:"data-entry.topic.html",controller:"dataEntryTopicCtrl",data:{parentState:"data-entry",parentStateTitle:"Data Entry"}}).state("data-entry-question",{url:"/data-entry-question",templateUrl:"data-entry.question.html",controller:"dataEntryQuestionCtrl",data:{parentState:"data-entry",parentStateTitle:"Data Entry"}}).state("users",{url:"/users",templateUrl:"users.html",controller:"usersCtrl"}).state("transactions",{url:"/transactions",templateUrl:"transactions.html",controller:"transactionsCtrl"}).state("transactions-payments",{url:"/transactions-payments",templateUrl:"transactions.payments.html",controller:"transactionsPaymentsCtrl",data:{parentState:"transactions",parentStateTitle:"Transactions"}}).state("transactions-subscription-prices",{url:"/transactions-subscription-prices",templateUrl:"transactions.subscription-prices.html",controller:"transactionsSubscriptionPricesCtrl",data:{parentState:"transactions",parentStateTitle:"Transactions"}})}]),app.run(["$rootScope","$state","$stateParams",function(a,b,c){a.$state=b,a.$stateParams=c}]),app.controller("dashboardCtrl",function(a,b){b.setPageTitle("Dashboard","fa fa-dashboard icon")}),app.controller("dataEntryCountryCtrl",function(a,b){a.data=_.isEmpty(a.data_entry.country.data)?[]:a.data_entry.country.data,a.filter={},a.currentDataRow=null,a.form={},a.loading=!1,b.setPageTitle("Country","fa fa-flag icon"),a.debCloseEditData=_.debounce(function(){$("section.awg-panel-edit").fadeOut("fast",function(){$(this).prev("#awg-panel-data-entry-country").show(),a.currentDataRow=null})},a.debDuration,a.debOptions),a.debSaveData=_.debounce(function(){var c=$("section.awg-panel-edit form"),d=c.find(".awg-form-button");if(c.parsley().validate(),c.parsley().isValid()){$(d).addClass("disabled");var e={id:a.currentDataRow.country_id,description:a.form.description,status:a.form.status};b.request("PATCH","api/country",e,function(c,e){if(_.isNull(c)){var f=_.clone(a.data),g=_.findIndex(f,_.first(_.filter(f,{country_id:a.currentDataRow.country_id})));a.currentDataRow.description=a.form.description,a.currentDataRow.status=a.form.status,a.data[g].description=a.form.description,a.data[g].status=+a.form.status,a.data_entry.country.data=a.data,b.notify("Success!","Successfully updated data.","success")}$(d).removeClass("disabled")})}},a.debDuration,a.debOptions),a.init=function(){0==a.data.length&&a.getData()},a.getData=function(){a.data=[],a.loading=!0,b.request("GET","api/country",{},function(b,c){_.isNull(b)&&(a.data=_.concat(a.data,c),a.data_entry.country.data=a.data),a.loading=!1})},a.filterStatus=function(b){a.filter.status=b},a.updateStatus=function(c,d){var e={id:d,status:c};b.request("PATCH","api/country",e,function(b,e){if(_.isNull(b)){var f=_.clone(a.data),g=_.findIndex(f,_.first(_.filter(f,{country_id:d})));a.data[g].status=c,a.data_entry.country.data=a.data}})},a.editData=function(b){a.currentDataRow=b,a.form.country_id=b.country_id,a.form.description=b.description,a.form.status=b.status.toString(),$("#awg-panel-data-entry-country").fadeOut("fast",function(){var a=$("section.awg-panel-edit form");a.parsley().reset(),$(this).next("section.awg-panel-edit").show()})},a.closeEditData=function(){a.debCloseEditData()},a.saveData=function(){a.debSaveData()}}),app.controller("dataEntryCtrl",function(a,b){b.setPageTitle("Data Entry","fa fa-list icon"),a.data_entry.menus=_.first(_.filter(a.menus,{"ui-sref":"data-entry"})).menus}),app.controller("dataEntryQuestionCtrl",function(a,b){b.setPageTitle("Question","fa fa-question icon")}),app.controller("dataEntrySubjectCtrl",function(a,b){a.data=_.isEmpty(a.data_entry.subject.data)?[]:a.data_entry.subject.data,a.filter={},a.currentDataRow=null,a.form={},a.action=null,a.loading=!1,b.setPageTitle("Subject","fa fa-bookmark icon"),a.debCloseEditData=_.debounce(function(){$("section.awg-panel-edit").fadeOut("fast",function(){$(this).prev("#awg-panel-data-entry-subject").show(),a.currentDataRow=null,a.action=null})},a.debDuration,a.debOptions),a.debSaveData=_.debounce(function(){var c=$("section.awg-panel-edit form"),d=c.find(".awg-form-button");if(c.parsley().validate(),c.parsley().isValid()){$(d).addClass("disabled");var e={description:a.form.description,status:a.form.status,topics:_.map(_.filter(a.form.dataTopics,{selected:!0}),"topic_id")};_.isEqual(a.action,"edit")?(e.id=a.currentDataRow.subject_id,b.request("PATCH","api/subject",e,function(c,f){if(_.isNull(c)){var g=_.clone(a.data),h=_.findIndex(g,_.first(_.filter(g,{subject_id:a.currentDataRow.subject_id})));a.currentDataRow.description=a.form.description,a.currentDataRow.status=a.form.status,a.currentDataRow.num_topics=e.topics.length,a.data[h].description=a.form.description,a.data[h].status=+a.form.status,a.data[h].num_topics=e.topics.length,a.data_entry.subject.data=a.data,b.notify("Success!","Successfully updated data.","success")}$(d).removeClass("disabled")})):_.isEqual(a.action,"add")&&b.request("POST","api/subject",e,function(c,e){_.isNull(c)&&(a.getData(),a.addData(),b.notify("Success!","Successfully added data.","success")),$(d).removeClass("disabled")})}},a.debDuration,a.debOptions),a.init=function(){0==a.data.length&&a.getData()},a.getData=function(){a.data=[],a.loading=!0,b.request("GET","api/subject",{},function(b,c){_.isNull(b)&&(a.data=_.concat(a.data,c),a.data_entry.subject.data=a.data),a.loading=!1})},a.getDataTopics=function(){a.form.dataTopics=[],a.form.loading=!0,async.parallel([function(a){var c={fields:"description,status,is_paid"};b.request("GET","api/topic",c,function(b,c){_.isNull(b)?a(null,c):a(b,null)})},function(c){if(_.isEqual(a.action,"edit")){var d={fields:"description,status,is_paid",subject_id:a.currentDataRow.subject_id};b.request("GET","api/topic",d,function(a,b){_.isNull(a)?c(null,b):c(a,null)})}else c(null,[])}],function(b,c){if(a.form.loading=!1,b)return void console.log(b);var d=_.map(c[1],function(a){return+a.topic_id}),e=_.map(c[0],function(a){return a.topic_id=+a.topic_id,a.selected=_.indexOf(d,a.topic_id)!=-1,a});a.form.dataTopics=e})},a.filterStatus=function(b){a.filter.status=b},a.filterFormStatus=function(b){a.form.filter.status=b},a.filterFormSelected=function(b){a.form.filter.selected=b},a.updateStatus=function(c,d){var e={id:d,status:c};b.request("PATCH","api/subject",e,function(b,e){if(_.isNull(b)){var f=_.clone(a.data),g=_.findIndex(f,_.first(_.filter(f,{subject_id:d})));a.data[g].status=c,a.data_entry.subject.data=a.data}})},a.editData=function(b){a.action="edit",a.currentDataRow=b,a.form.description=b.description,a.form.status=b.status.toString(),a.form.dataTopics=[],a.form.query="",a.form.filter={},a.form.loading=!1,$("#awg-panel-data-entry-subject").fadeOut("fast",function(){var b=$("section.awg-panel-edit form");b.parsley().reset(),$(this).next("section.awg-panel-edit").show(),a.getDataTopics()})},a.addData=function(){a.action="add",a.form.description="",a.form.status="",a.form.dataTopics=[],a.form.query="",a.form.filter={},a.form.loading=!1,$("#awg-panel-data-entry-subject").fadeOut("fast",function(){var b=$("section.awg-panel-edit form");b.parsley().reset(),$(this).next("section.awg-panel-edit").show(),a.getDataTopics()})},a.closeEditData=function(){a.debCloseEditData()},a.saveData=function(){a.debSaveData()},a.check=function(b){var c=_.clone(a.form.dataTopics),d=_.findIndex(c,_.first(_.filter(c,{topic_id:b}))),e=a.form.dataTopics[d].selected;a.form.dataTopics[d].selected=!e},a.checkAll=function(b){_.each(a.form.dataTopics,function(a,c){a.selected=!!b})}}),app.controller("dataEntrySyllabiCtrl",function(a,b){a.data=_.isEmpty(a.data_entry.syllabi.data)?[]:a.data_entry.syllabi.data,a.filter={},a.currentDataRow=null,a.form={},a.action=null,a.loading=!1,b.setPageTitle("Syllabi","fa fa-book icon"),a.debCloseEditData=_.debounce(function(){$("section.awg-panel-edit").fadeOut("fast",function(){$(this).prev("#awg-panel-data-entry-syllabi").show(),a.currentDataRow=null,a.action=null})},a.debDuration,a.debOptions),a.debSaveData=_.debounce(function(){var c=$("section.awg-panel-edit form"),d=c.find(".awg-form-button");if(c.parsley().validate(),c.parsley().isValid()){$(d).addClass("disabled");var e={description:a.form.description,status:a.form.status,subjects:_.map(_.filter(a.form.dataSubjects,{selected:!0}),"subject_id")};_.isEqual(a.action,"edit")?(e.id=a.currentDataRow.syllabus_id,b.request("PATCH","api/syllabi",e,function(c,f){if(_.isNull(c)){var g=_.clone(a.data),h=_.findIndex(g,_.first(_.filter(g,{syllabus_id:a.currentDataRow.syllabus_id})));a.currentDataRow.description=a.form.description,a.currentDataRow.status=a.form.status,a.currentDataRow.num_subjects=e.subjects.length,a.data[h].description=a.form.description,a.data[h].status=+a.form.status,a.data[h].num_subjects=e.subjects.length,a.data_entry.syllabi.data=a.data,b.notify("Success!","Successfully updated data.","success")}$(d).removeClass("disabled")})):_.isEqual(a.action,"add")&&b.request("POST","api/syllabi",e,function(c,e){_.isNull(c)&&(a.getData(),a.addData(),b.notify("Success!","Successfully added data.","success")),$(d).removeClass("disabled")})}},a.debDuration,a.debOptions),a.init=function(){0==a.data.length&&a.getData()},a.getData=function(){a.data=[],a.loading=!0,b.request("GET","api/syllabi",{},function(b,c){_.isNull(b)&&(a.data=_.concat(a.data,c),a.data_entry.syllabi.data=a.data),a.loading=!1})},a.getDataSubjects=function(){a.form.dataSubjects=[],a.form.loading=!0,async.parallel([function(a){var c={fields:"description,status"};b.request("GET","api/subject",c,function(b,c){_.isNull(b)?a(null,c):a(b,null)})},function(c){if(_.isEqual(a.action,"edit")){var d={fields:"description,status",syllabi_id:a.currentDataRow.syllabus_id};b.request("GET","api/subject",d,function(a,b){_.isNull(a)?c(null,b):c(a,null)})}else c(null,[])}],function(b,c){if(a.form.loading=!1,b)return void console.log(b);var d=_.map(c[1],function(a){return+a.subject_id}),e=_.map(c[0],function(a){return a.subject_id=+a.subject_id,a.selected=_.indexOf(d,a.subject_id)!=-1,a});a.form.dataSubjects=e})},a.filterStatus=function(b){a.filter.status=b},a.filterFormStatus=function(b){a.form.filter.status=b},a.filterFormSelected=function(b){a.form.filter.selected=b},a.updateStatus=function(c,d){var e={id:d,status:c};b.request("PATCH","api/syllabi",e,function(b,e){if(_.isNull(b)){var f=_.clone(a.data),g=_.findIndex(f,_.first(_.filter(f,{syllabus_id:d})));a.data[g].status=c,a.data_entry.syllabi.data=a.data}})},a.editData=function(b){a.action="edit",a.currentDataRow=b,a.form.description=b.description,a.form.status=b.status.toString(),a.form.dataSubjects=[],a.form.query="",a.form.filter={},a.form.loading=!1,$("#awg-panel-data-entry-syllabi").fadeOut("fast",function(){var b=$("section.awg-panel-edit form");b.parsley().reset(),$(this).next("section.awg-panel-edit").show(),a.getDataSubjects()})},a.addData=function(){a.action="add",a.form.description="",a.form.status="",a.form.dataSubjects=[],a.form.query="",a.form.filter={},a.form.loading=!1,$("#awg-panel-data-entry-syllabi").fadeOut("fast",function(){var b=$("section.awg-panel-edit form");b.parsley().reset(),$(this).next("section.awg-panel-edit").show(),a.getDataSubjects()})},a.closeEditData=function(){a.debCloseEditData()},a.saveData=function(){a.debSaveData()},a.check=function(b){var c=_.clone(a.form.dataSubjects),d=_.findIndex(c,_.first(_.filter(c,{subject_id:b}))),e=a.form.dataSubjects[d].selected;a.form.dataSubjects[d].selected=!e},a.checkAll=function(b){_.each(a.form.dataSubjects,function(a,c){a.selected=!!b})}}),app.controller("dataEntryTopicCtrl",function(a,b){b.setPageTitle("Topic","fa fa-certificate icon")}),app.controller("mainCtrl",function(a,b,c){a._=_,a.state=b,a.pageService=c,a.dashboard={},a.data_entry={country:{data:[]},syllabi:{data:[]},subject:{data:[]},topic:{},question:{}},a.users={data:[]},a.transactions={payments:{data:[]},prices:{data:[]}},a.debDuration=500,a.debOptions={leading:!0,trailing:!1},a.menus=[{title:"Dashboard",iconClass:"fa fa-dashboard icon",bgClass:"bg-info","ui-sref":"dashboard"},{title:"Data Entry",iconClass:"fa fa-list icon",bgClass:"bg-primary","ui-sref":"data-entry",menus:[{title:"Country",iconClass:"fa fa-flag icon","ui-sref":"data-entry-country"},{title:"Syllabi",iconClass:"fa fa-book icon","ui-sref":"data-entry-syllabi"},{title:"Subject",iconClass:"fa fa-bookmark icon","ui-sref":"data-entry-subject"},{title:"Topic",iconClass:"fa fa-certificate icon","ui-sref":"data-entry-topic"},{title:"Question",iconClass:"fa fa-question icon","ui-sref":"data-entry-question"}]},{title:"Users",iconClass:"fa fa-users icon",bgClass:"bg-danger","ui-sref":"users"},{title:"Transactions",iconClass:"fa fa-suitcase icon",bgClass:"bg-warning","ui-sref":"transactions",menus:[{title:"Payments",iconClass:"fa fa-cc-paypal icon","ui-sref":"transactions-payments"},{title:"Subscription Prices",iconClass:"fa fa-dollar icon","ui-sref":"transactions-subscription-prices"}]}],a.getMenuClass=function(a){return _.has(a,"ui-sref")&&(_.isEqual(a["ui-sref"],b.current.name)||b.current.name.indexOf(a["ui-sref"])!=-1)?"active":""},a.getUiSref=function(a){return _.has(a,"ui-sref")&&!_.isEmpty(a["ui-sref"])?a["ui-sref"]:"."},a.scrollToTop=function(){}}),app.controller("transactionsCtrl",function(a,b){b.setPageTitle("Transactions","fa fa-suitcase icon"),a.transactions.menus=_.first(_.filter(a.menus,{"ui-sref":"transactions"})).menus}),app.controller("transactionsPaymentsCtrl",function(a,b){a.data=_.isEmpty(a.transactions.payments.data)?[]:a.transactions.payments.data,a.filter={},a.loading=!1,b.setPageTitle("Payments","fa fa-cc-paypal icon"),a.init=function(){0==a.data.length&&a.getData()},a.getData=function(){a.data=[],a.loading=!0,b.request("GET","api/payments",{},function(b,c){_.isNull(b)&&(a.data=_.concat(a.data,c),a.transactions.payments.data=a.data),a.loading=!1})},a.filterPayer=function(b){a.filter.item_name=b}}),app.controller("transactionsSubscriptionPricesCtrl",function(a,b){a.data=_.isEmpty(a.transactions.prices.data)?[]:a.transactions.prices.data,a.currentDataRow=null,a.form={},a.loading=!1,b.setPageTitle("Subscription Prices","fa fa-dollar icon"),a.debCloseEditData=_.debounce(function(){$("section.awg-panel-edit").fadeOut("fast",function(){a.currentDataRow=null})},a.debDuration,a.debOptions),a.debSaveData=_.debounce(function(){var c=$("section.awg-panel-edit form"),d=c.find(".awg-form-button");if(c.parsley().validate(),c.parsley().isValid()){$(d).addClass("disabled");var e={id:a.currentDataRow.type_id,description:a.form.description,price:a.form.price};b.request("PATCH","api/prices",e,function(c,e){if(_.isNull(c)){var f=_.clone(a.data),g=_.findIndex(f,_.first(_.filter(f,{type_id:a.currentDataRow.type_id})));a.currentDataRow.description=a.form.description,a.currentDataRow.price=a.form.price,a.data[g].description=a.form.description,a.data[g].price=+a.form.price,a.transactions.prices.data=a.data,b.notify("Success!","Successfully updated data.","success")}$(d).removeClass("disabled")})}},a.debDuration,a.debOptions),a.init=function(){0==a.data.length&&a.getData()},a.getData=function(){a.data=[],a.loading=!0,b.request("GET","api/prices",{},function(b,c){_.isNull(b)&&(a.data=_.concat(a.data,c),a.transactions.prices.data=a.data),a.loading=!1})},a.editData=function(b){a.currentDataRow=b,a.form.type_id=b.type_id,a.form.payer=_.isEqual(b.payer,"I")?"Individual":"School",a.form.description=b.description,a.form.price=+b.price;var c=$("section.awg-panel-edit form");c.parsley().reset(),$("section.awg-panel-edit").show()},a.closeEditData=function(){a.debCloseEditData()},a.saveData=function(){a.debSaveData()}}),app.controller("usersCtrl",function(a,b){a.data=_.isEmpty(a.users.data)?[]:a.users.data,a.filter={},a.paymentStatus="",a.currentDataRow=null,a.form={},a.loading=!1,b.setPageTitle("Users","fa fa-users icon"),a.debCloseEditData=_.debounce(function(){$("section.awg-panel-edit").fadeOut("fast",function(){$(this).prev("#awg-panel-users").show(),a.currentDataRow=null})},a.debDuration,a.debOptions),a.debSaveData=_.debounce(function(){var c=$("section.awg-panel-edit form"),d=c.find(".awg-form-button");if(c.parsley().validate(),c.parsley().isValid()){$(d).addClass("disabled");var e={id:a.currentDataRow.account_id,account_type:a.form.account_type,payment_status:a.form.payment_status,status:a.form.status};b.request("PATCH","api/users",e,function(c,e){if(_.isNull(c)){var f=_.clone(a.data),g=_.findIndex(f,_.first(_.filter(f,{country_id:a.currentDataRow.account_id})));a.currentDataRow.account_type=a.form.account_type,a.currentDataRow.payment_status=a.form.payment_status,a.currentDataRow.status=a.form.status,a.data[g].account_type=a.form.account_type,a.data[g].payment_status=a.form.payment_status,a.data[g].status=+a.form.status,a.users.data=a.data,b.notify("Success!","Successfully updated data.","success")}$(d).removeClass("disabled")})}},a.debDuration,a.debOptions),a.init=function(){0==a.data.length&&a.getData()},a.getData=function(){a.data=[],a.loading=!0,b.request("GET","api/users",{},function(b,c){_.isNull(b)&&(a.data=_.concat(a.data,c),a.users.data=a.data),a.loading=!1})},a.filterAccountType=function(b){a.filter.account_type=b},a.filterPaymentStatus=function(b){return!!_.isEqual(a.paymentStatus,"")||_.isEqual(b.payment_status,a.paymentStatus)},a.filterStatus=function(b){a.filter.status=b},a.setFilterPaymentStatus=function(b){a.paymentStatus=b},a.updateStatus=function(c,d){var e={id:d,status:c};b.request("PATCH","api/users",e,function(b,e){if(_.isNull(b)){var f=_.clone(a.data),g=_.findIndex(f,_.first(_.filter(f,{account_id:d})));a.data[g].status=c,a.users.data=a.data}})},a.editData=function(b){a.currentDataRow=b,console.log(b),a.form.account_id=b.account_id,a.form.first_name=b.first_name,a.form.surname=b.surname,a.form.account_type=b.account_type,a.form.payment_status=b.payment_status,a.form.status=b.status.toString(),$("#awg-panel-users").fadeOut("fast",function(){var a=$("section.awg-panel-edit form");a.parsley().reset(),$(this).next("section.awg-panel-edit").show()})},a.closeEditData=function(){a.debCloseEditData()},a.saveData=function(){a.debSaveData()}}),app.directive("a",function(){return{restrict:"E",link:function(a,b,c){(c.ngClick||""===c.href||"#"===c.href)&&b.on("click",function(a){a.preventDefault()})}}}),app.service("pageService",function(a,b,c){var d="",e="";this.getBreadcrumbs=function(){for(var a=[],e=b.current;_.has(e,"data");){var f=b.get(e.data.parentState);a.push({title:e.data.parentStateTitle,"ui-sref":f.name}),e=f}_.reverse(a);var g="";return g+='<li><a href="" ui-sref="dashboard"><i class="fa fa-home"></i> Home</a></li>',_.each(a,function(a){g+='<li><a href="#/'+a["ui-sref"]+'">'+a.title+"</a></li>"}),g+="<li>"+d+"</li>",c.trustAsHtml(g)},this.getPageTitle=function(){return c.trustAsHtml(e)},this.setPageTitle=function(a,b){d=a,e=(_.isUndefined(b)?"":'<i class="'+b+'"></i> ')+a},this.request=function(b,c,d,e){var f=["GET","POST","DELETE","PATCH","PUT"],d=_.isUndefined(d)?{}:d,g=this;if($.inArray(_.toUpper(b),f)!=-1){var h=_.isEqual(_.toUpper(b),"GET")?{params:d}:d;a[_.toLower(b)](c,h).success(function(a){e(null,a)}).error(function(a){g.notify("Error!",a.message,"danger"),e({status:!1},null)})}else this.notify("Error!","Passed method is not a valid HTTP method.","danger"),e({status:!1},null)},this.notify=function(a,b,c){var a=_.isUndefined(a)?"Notification":a,b=_.isUndefined(b)?"":b,c=_.isUndefined(c)||_.indexOf(["success","info","danger","warning"],c)==-1?"info":c;$.notify({title:"<div><strong>"+a+"</strong></div>",message:b},{type:c,offset:{y:60,x:20}})}});